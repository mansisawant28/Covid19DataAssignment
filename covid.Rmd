---
title: "Covid"
output: html_document
date: "2025-11-14"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(scales)
```
URLs for Johns Hopkins COVID-19 datasets
```{r import}
url_global_confirmed <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"
url_global_deaths <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv"
url_us_confirmed <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"
url_us_deaths <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"
```
Import datasets
```{r import_dataset}
global_confirmed <- readr::read_csv(url_global_confirmed)
global_deaths <- readr::read_csv(url_global_deaths)
us_confirmed <- readr::read_csv(url_us_confirmed)
us_deaths <- readr::read_csv(url_us_deaths)
```
# Tidy global confirmed
```{r tidy_data}
global_confirmed_long <- global_confirmed %>%
  pivot_longer(
    cols = matches("[0-9]+/[0-9]+/[0-9]+"),
    names_to = "Date",
    values_to = "Confirmed"
  ) %>%
  mutate(Date = mdy(Date)) %>%
  group_by(`Country/Region`, Date) %>%
  summarize(Confirmed = sum(Confirmed), .groups = "drop")

# Similarly for global deaths
global_deaths_long <- global_deaths %>%
  pivot_longer(
    cols = matches("[0-9]+/[0-9]+/[0-9]+"),
    names_to = "Date",
    values_to = "Deaths"
  ) %>%
  mutate(Date = mdy(Date)) %>%
  group_by(`Country/Region`, Date) %>%
  summarize(Deaths = sum(Deaths), .groups = "drop")

##And for US datasets:


us_confirmed_long <- us_confirmed %>%
  pivot_longer(
    cols = matches("[0-9]+/[0-9]+/[0-9]+"),
    names_to = "Date",
    values_to = "Confirmed"
  ) %>%
  mutate(Date = mdy(Date)) %>%
  group_by(Province_State, Date) %>%
  summarize(Confirmed = sum(Confirmed), .groups = "drop")

us_deaths_long <- us_deaths %>%
  pivot_longer(
    cols = matches("[0-9]+/[0-9]+/[0-9]+"),
    names_to = "Date",
    values_to = "Deaths"
  ) %>%
  mutate(Date = mdy(Date)) %>%
  group_by(Province_State, Date) %>%
  summarize(Deaths = sum(Deaths), .groups = "drop")
```
Combine datasets
```{r cleaning}
global_long <- left_join(global_confirmed_long, global_deaths_long, by = c("Country/Region", "Date"))
us_long <- left_join(us_confirmed_long, us_deaths_long, by = c("Province_State" = "Province_State", "Date"))

#Add Type column

global_long <- global_long %>% mutate(Type = "Global")
us_long <- us_long %>% mutate(Type = "US")

#Concatenate datasets

combined_covid <- bind_rows(
  global_long %>% rename(Region = `Country/Region`),
  us_long %>% rename(Region = Province_State)
)

#Order by Region and Date

combined_covid <- combined_covid %>%
arrange(Type, Region, Date)

head(combined_covid)

#Calculate daily new cases and deaths

combined_covid <- combined_covid %>%
group_by(Type, Region) %>%
mutate(
Daily_Cases = Confirmed - lag(Confirmed, default = 0),
Daily_Deaths = Deaths - lag(Deaths, default = 0)
) %>%
ungroup()
```

Visualization 1: US as Percentage of Global Cases
```{r visualization}
trend_data <- combined_covid %>%
group_by(Type, Date) %>%
summarize(Total_Confirmed = sum(Confirmed), .groups = "drop") %>%
pivot_wider(names_from = Type, values_from = Total_Confirmed) %>%
mutate(US_percent_of_global = US / Global * 100)

ggplot(trend_data, aes(x = Date, y = US_percent_of_global)) +
geom_line(color = "red", size = 1.2) +
labs(
title = "US COVID-19 Cases as Percentage of Global Cases",
x = "Date",
y = "US % of Global Cases"
) +
theme_minimal()
```
Explanation:

Shows US share of global cases over time.

Highlights periods when the US contributed a large proportion of global cases.

Useful because raw global numbers dominate and can obscure US trends.

Visualization 2: Top 10 Regions by Total Cases
```{r visualization2}
top_regions <- combined_covid %>%
filter(Date == max(Date)) %>%
arrange(desc(Confirmed)) %>%
slice(1:10)

ggplot(top_regions, aes(x = reorder(Region, Confirmed), y = Confirmed, fill = Type)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels = scales::comma) +
labs(
title = "Top 10 Regions by Total Confirmed COVID-19 Cases",
x = "Region",
y = "Confirmed Cases",
fill = "Dataset"
) +
theme_minimal()
```
Explanation:

Quickly identifies the hardest-hit regions.

coord_flip() improves readability.

fill = Type distinguishes US vs Global regions.

Linear Model: Short-Term Trend for US Daily Cases
Last 30 days of US daily cases
```{r model_fitting}
recent_us <- combined_covid %>%
filter(Region == "US") %>%
arrange(Date) %>%
select(Date, Daily_Cases) %>%
tail(30) %>%
mutate(Day = 1:30)

#Fit linear regression

lm_fit <- lm(Daily_Cases ~ Day, data = recent_us)
summary(lm_fit)

#Predict next 7 days

future_days <- data.frame(Day = 31:37)
predicted_cases <- predict(lm_fit, newdata = future_days)

#Combine observed and predicted for plotting

future_df <- data.frame(Day = 31:37, Daily_Cases = predicted_cases, Type = "Predicted")
recent_us$Type <- "Observed"
plot_df <- bind_rows(recent_us, future_df)

#Plot

ggplot(plot_df, aes(x = Day, y = Daily_Cases, color = Type)) +
geom_line(size = 1.2) +
labs(title = "Linear Trend Forecast for US Daily COVID-19 Cases",
x = "Day (last 30 + 7 forecast)",
y = "Daily Cases") +
theme_minimal() +
scale_color_manual(values = c("Observed" = "steelblue", "Predicted" = "red"))
```
Explanation:

Linear model estimates short-term trend in daily US cases.

Blue line: observed cases; red line: predicted next 7 days.

Positive slope → increasing daily cases; negative slope → decreasing.

Simplistic model; best for short-term prediction.
Bias and Limitations

Data-Related Bias:

Underreporting of cases and deaths.

Delays and inconsistencies in reporting.

Variable testing rates across regions.

Aggregation of regions can hide local trends.

Analysis-Related Bias:

Linear model assumes constant trend; cannot capture waves or spikes.

Visualization may exaggerate or understate trends depending on scale or perspective.

US vs Global comparisons may be skewed by population size.

Mitigation:

Use daily cases with rolling averages.

Clearly state limitations in reporting and modeling.

Focus on short-term trends rather than long-term forecasts.